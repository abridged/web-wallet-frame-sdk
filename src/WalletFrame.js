const e=function(){function e(){}return e.prototype.then=function(n,r){const o=new e,i=this.s;if(i){const e=1&i?n:r;if(e){try{t(o,1,e(this.v))}catch(e){t(o,2,e)}return o}return this}return this.o=function(e){try{const i=e.v;1&e.s?t(o,1,n?n(i):i):r?t(o,1,r(i)):t(o,2,i)}catch(e){t(o,2,e)}},o},e}();function t(n,r,o){if(!n.s){if(o instanceof e){if(!o.s)return void(o.o=t.bind(null,n,r));1&r&&(r=o.s),o=o.v}if(o&&o.then)return void o.then(t.bind(null,n,r),t.bind(null,n,2));n.s=r,n.v=o;const i=n.o;i&&i(n)}}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var n=function(e,t,n){if(!e)throw new Error("no sdk provided");this.sdk=e,this._window=t,this.pubkey=n,this.account=n,this._handleIframeTask=this.handleIframeTask.bind(this)};n.prototype.setPrompt=function(e){this.prompt=e},n.prototype._doPrompt=function(e){try{var t=this.prompt;t||(t=function(e,t,n){confirm("Do you want to continue? Transaction: "+e)?t():n()});var n=new Promise(function(n,r){t(e,n,r)});return Promise.resolve(n)}catch(e){return Promise.reject(e)}},n.prototype.destroy=function(){try{return this._window.addEventListener("message",this._handleIframeTask),Promise.resolve()}catch(e){return Promise.reject(e)}},n.prototype.setup=function(e,t){try{var n=this;if(!n.pubkey&&!n.account)throw new Error("provide pub address");if(!e)throw new Error("frame reference is not set: setup(iframRef, frameSrc)");n.iframRef&&destroy(),n.frameSrc=t,n.iframRef=e,n._window.addEventListener("message",n._handleIframeTask);var r=new Promise(function(e){var t=function(){n.iframRef.removeEventListener("load",t),e()};n.iframRef.addEventListener("load",t)});return n.iframRef.src=t,Promise.resolve(r)}catch(e){return Promise.reject(e)}},n.prototype.stop=function(){this._window.removeEventListener("message",this._handleIframeTask)},n.prototype.handleIframeTask=function(e){var t=e.data;t.jsonrpc&&r(t,this.account,this.iframRef,this.sdk)},n.prototype.createAccount=function(e){try{var t=this;return Promise.resolve(t.sdk.createAccount(e).then(function(e){return console.log("x2 postcreateAccount",e.address,"x.deployed="+e.deployed),t.account=e.address,e}))}catch(e){return Promise.reject(e)}};var r=function(n,r,o,i){try{var a=!1;function s(){null!==v&&(d.result=v);var e=Object.assign({},d);if(console.log("responding",e),!o.contentWindow)throw console.log("refiFrame.contentWindow",o.contentWindow),new Error("cannot access iFrame, check CORS");o.contentWindow.postMessage(e,"*")}var c=n.method,u=n.params,f=n.jsonrpc;console.log("handleIframeTask",n);var d={jsonrpc:f,id:n.id},h=u&&u.length>0,l=h?u[0]:null,m={},v=null,p=function(n,r){var o,i=-1;e:{for(var a=0;a<r.length;a++){var s=r[a][0];if(s){var c=s();if(c&&c.then)break e;if(c===n){i=a;break}}else i=a}if(-1!==i){do{for(var u=r[i][1];!u;)u=r[++i][1];var f=u();if(f&&f.then){o=!0;break e}var d=r[i][2];i++}while(d&&!d());return f}}const h=new e,l=t.bind(null,h,2);return(o?f.then(m):c.then(function e(o){for(;;){if(o===n){i=a;break}if(++a===r.length){if(-1!==i)break;return void t(h,1,u)}if(s=r[a][0]){if((o=s())&&o.then)return void o.then(e).then(void 0,l)}else i=a}do{for(var c=r[i][1];!c;)c=r[++i][1];var u=c();if(u&&u.then)return void u.then(m).then(void 0,l);var f=r[i][2];i++}while(f&&!f());t(h,1,u)})).then(void 0,l),h;function m(e){for(;;){var n=r[i][2];if(!n||n())break;for(var o=r[++i][1];!o;)o=r[++i][1];if((e=o())&&e.then)return void e.then(m).then(void 0,l)}t(h,1,e)}}(c,[[function(){return"enable"},function(){v=[r],a=!0}],[function(){return"eth_accounts"},function(){v=[r],a=!0}],[function(){return"eth_getBalance"},function(){return m=h?{address:u[0]}:{},Promise.resolve(i.getBalance(m)).then(function(e){console.log("getBalance",e),v="0x"+e.toString(16),a=!0})}],[function(){return"eth_sendTransaction"},function(){if(h)return m={recipient:l.to,value:toBN(l.value),data:l.data},Promise.resolve(i.batchExecuteAccountTransaction(m)).then(function(){return Promise.resolve(i.estimateBatch()).then(function(){return Promise.resolve(i.submitBatch()).then(function(){v=[],a=!0})})});a=!0},function(){return a||a}],[function(){return"eth_gasPrice"},function(){v="0x0",a=!0}],[function(){return"web3_clientVersion"},function(){v="3frame/0.0.11"},function(){}],[void 0,function(){console.warn("non implemented event:",n),v=""},function(){}]]);return Promise.resolve(p&&p.then?p.then(s):s())}catch(e){return Promise.reject(e)}};exports.FrameProvider=n,exports.default=n;
//# sourceMappingURL=WalletFrame.js.map
